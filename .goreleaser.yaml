version: 2
project_name: prometheus-fake-remote-read

release:
  name_template: "{{ .ProjectName }}-v{{ .Version }}"
  prerelease: auto

builds:
- main: ./cmd/prometheus-fake-remote-read
  goos:
  - linux
  - darwin
  - windows
  goarch:
  - amd64
  - arm64
  env:
  - CGO_ENABLED=0

archives:
- format: tar.gz
  name_template: "{{ .ProjectName }}_{{ .Version }}_{{ .Os }}_{{ .Arch }}"
  files:
  - README.md
  format_overrides:
  - goos: windows
    format: zip

checksum:
  name_template: "checksums.txt"

dockers:
- image_templates:
  - "ghcr.io/vitalyu/{{ .ProjectName }}:{{ .Version }}-amd64"
  goarch: amd64
  dockerfile: Dockerfile
  use: buildx
  build_flag_templates:
  - --platform=linux/amd64
  extra_files:
  - configs/example.config.json

- image_templates:
  - "ghcr.io/vitalyu/{{ .ProjectName }}:{{ .Version }}-arm64"
  goarch: arm64
  dockerfile: Dockerfile
  use: buildx
  build_flag_templates:
  - --platform=linux/arm64/v8
  extra_files:
  - configs/example.config.json

docker_manifests:
- name_template: "ghcr.io/vitalyu/{{ .ProjectName }}:{{ .Version }}"
  image_templates:
  - "ghcr.io/vitalyu/{{ .ProjectName }}:{{ .Version }}-amd64"
  - "ghcr.io/vitalyu/{{ .ProjectName }}:{{ .Version }}-arm64"

- name_template: "ghcr.io/vitalyu/{{ .ProjectName }}:latest"
  image_templates:
  - "ghcr.io/vitalyu/{{ .ProjectName }}:{{ .Version }}-amd64"
  - "ghcr.io/vitalyu/{{ .ProjectName }}:{{ .Version }}-arm64"
